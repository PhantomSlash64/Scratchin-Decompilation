using System;
using System.Runtime.InteropServices;
using Rewired;
using Rewired.Platforms;

internal class eHhFvRASFyFXeJYsXFOQiqQetFL : IDisposable, uueYtIaFuqpDtLvuwArzLHVIeCr
{
	private static class cQIgVJJdisvDtRwntSvRLVibUPn
	{
		private struct yBpsKhjcrToJOnogQmSZWjuQLGj
		{
			internal int OAxxiRRJUwaMLNmFaPAXfzgmRpb;

			internal int yrBKgxgwtsXACurkrpnBjVvVoyl;

			internal int ltMhmIaxLmZNawAPllSWxysDUR;

			internal Guid UEbINbYOIsEMMrTskfCeDEUHOsWB;

			internal short bXjwznmhBpYblwUBYTWSOIeBUjj;
		}

		private const int aHTTClcHZGUmoVsYTVSRrjuCQnW = 5;

		private const int SsHMmVDigqjCfEbWuvpMQmOgPcOu = 0;

		private static readonly Guid VXfSbCFhluDfOKgxpiojhvZmwDpD = new Guid("4D1E55B2-F16F-11CF-88CB-001111000030");

		private static IntPtr iAxRkYShZowLaeNUMenorRgwXiV;

		private static bool SvKjANdzwTdyzUUldIbyPngPfrY;

		public static void cGXsBvuVVhZxTbvVTlcbffdVHPu(IntPtr P_0)
		{
			yBpsKhjcrToJOnogQmSZWjuQLGj yBpsKhjcrToJOnogQmSZWjuQLGj = default(yBpsKhjcrToJOnogQmSZWjuQLGj);
			yBpsKhjcrToJOnogQmSZWjuQLGj.yrBKgxgwtsXACurkrpnBjVvVoyl = 5;
			yBpsKhjcrToJOnogQmSZWjuQLGj.ltMhmIaxLmZNawAPllSWxysDUR = 0;
			yBpsKhjcrToJOnogQmSZWjuQLGj.UEbINbYOIsEMMrTskfCeDEUHOsWB = VXfSbCFhluDfOKgxpiojhvZmwDpD;
			yBpsKhjcrToJOnogQmSZWjuQLGj.bXjwznmhBpYblwUBYTWSOIeBUjj = 0;
			yBpsKhjcrToJOnogQmSZWjuQLGj yBpsKhjcrToJOnogQmSZWjuQLGj2 = yBpsKhjcrToJOnogQmSZWjuQLGj;
			yBpsKhjcrToJOnogQmSZWjuQLGj2.OAxxiRRJUwaMLNmFaPAXfzgmRpb = Marshal.SizeOf((object)yBpsKhjcrToJOnogQmSZWjuQLGj2);
			IntPtr intPtr = Marshal.AllocHGlobal(yBpsKhjcrToJOnogQmSZWjuQLGj2.OAxxiRRJUwaMLNmFaPAXfzgmRpb);
			Marshal.StructureToPtr((object)yBpsKhjcrToJOnogQmSZWjuQLGj2, intPtr, fDeleteOld: true);
			iAxRkYShZowLaeNUMenorRgwXiV = sCJXYyhQRNmykoszniPBgIWphBg(P_0, intPtr, 0);
			SvKjANdzwTdyzUUldIbyPngPfrY = true;
		}

		public static void QmjvwBHpzwQNlhCOTdTSEIFimJt()
		{
			if (!(iAxRkYShZowLaeNUMenorRgwXiV == IntPtr.Zero))
			{
				GCRjYHBTjmfktdtLZefIDZIInrnW(iAxRkYShZowLaeNUMenorRgwXiV);
				SvKjANdzwTdyzUUldIbyPngPfrY = false;
			}
		}

		[DllImport("user32.dll", CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Unicode, EntryPoint = "RegisterDeviceNotification", SetLastError = true)]
		private static extern IntPtr sCJXYyhQRNmykoszniPBgIWphBg(IntPtr P_0, IntPtr P_1, int P_2);

		[DllImport("user32.dll", CallingConvention = CallingConvention.StdCall, CharSet = CharSet.Unicode, EntryPoint = "UnregisterDeviceNotification")]
		private static extern bool GCRjYHBTjmfktdtLZefIDZIInrnW(IntPtr P_0);
	}

	private const int duycJxEqMXQHmPKykFEVyakFLgtA = 32771;

	private const int LjywyahfxxwOVKnrBCcrBzwtOKNI = 32772;

	private const int HifnyFSPVwsjuYQtGNkIdmBpPis = 32768;

	private const int apsKIgsbOEGTcGgKLIjnLsUOghfK = 7;

	private const int wpTdKgwfoVrlZDdtpTOivqvJNOv = 537;

	private const int AdCzIsNOuWdLXEQlvsNocObBRdqe = 255;

	private Action<EventArgs> qssbxDKOsHmTthmzrBfaEqCIPoe;

	private Action<EventArgs> WnixkiRzHZDcGoLvtzgfeoDtNns;

	private Action<EventArgs> MhXobjWyTEqREAZtqhwtbUDnBlb;

	private Action<EewfJPiHasEmIcMTTMpQEfUhPRej, DyFiWUvcefuGqAjWbnTJbGBhzSo> riIEwybyjVOZyYtKuIovKpwwcmKD;

	private IntPtr MhbfrdOtrnfeYyGidkJneDJMCHl;

	private wVnRJnyiuYlKPyyEIIoPAybhJhE FYsFYuFxEQPhvrIGlRzuHTRvwXR;

	private readonly bool VUjjFdeMXVjpMKMhYRosEXhUuLM;

	private static iDxdeTNcZIetTcswDuZFhoDBYPo CByBxCUKhKOJsFWCavGXqfwCGkN;

	private wVnRJnyiuYlKPyyEIIoPAybhJhE QCoNPBijDfLcXXQcHwZHDPDFkqz;

	private bool jpnIPbpqmlecdiNqaFAxiNCsiMxs;

	public IntPtr cydNPfNgnIKkNtZVdrByOJGWCUKA => MhbfrdOtrnfeYyGidkJneDJMCHl;

	public event Action<EventArgs> cnPtxUsrfEsgVOLONDxTccaVcpp
	{
		add
		{
			qssbxDKOsHmTthmzrBfaEqCIPoe = (Action<EventArgs>)Delegate.Combine(qssbxDKOsHmTthmzrBfaEqCIPoe, value);
		}
		remove
		{
			qssbxDKOsHmTthmzrBfaEqCIPoe = (Action<EventArgs>)Delegate.Remove(qssbxDKOsHmTthmzrBfaEqCIPoe, value);
		}
	}

	public event Action<EventArgs> znXDINUcaSpSLBQsoaQnnXtWxYE
	{
		add
		{
			WnixkiRzHZDcGoLvtzgfeoDtNns = (Action<EventArgs>)Delegate.Combine(WnixkiRzHZDcGoLvtzgfeoDtNns, value);
		}
		remove
		{
			WnixkiRzHZDcGoLvtzgfeoDtNns = (Action<EventArgs>)Delegate.Remove(WnixkiRzHZDcGoLvtzgfeoDtNns, value);
		}
	}

	public event Action<EventArgs> YrUvgKeUMOhTzpKJVvUWIEzBpZh
	{
		add
		{
			MhXobjWyTEqREAZtqhwtbUDnBlb = (Action<EventArgs>)Delegate.Combine(MhXobjWyTEqREAZtqhwtbUDnBlb, value);
		}
		remove
		{
			MhXobjWyTEqREAZtqhwtbUDnBlb = (Action<EventArgs>)Delegate.Remove(MhXobjWyTEqREAZtqhwtbUDnBlb, value);
		}
	}

	public event Action<EewfJPiHasEmIcMTTMpQEfUhPRej, DyFiWUvcefuGqAjWbnTJbGBhzSo> IyvwYukxIQplJvCAncFEhcNJUDlU
	{
		add
		{
			riIEwybyjVOZyYtKuIovKpwwcmKD = (Action<EewfJPiHasEmIcMTTMpQEfUhPRej, DyFiWUvcefuGqAjWbnTJbGBhzSo>)Delegate.Combine(riIEwybyjVOZyYtKuIovKpwwcmKD, value);
		}
		remove
		{
			riIEwybyjVOZyYtKuIovKpwwcmKD = (Action<EewfJPiHasEmIcMTTMpQEfUhPRej, DyFiWUvcefuGqAjWbnTJbGBhzSo>)Delegate.Remove(riIEwybyjVOZyYtKuIovKpwwcmKD, value);
		}
	}

	public eHhFvRASFyFXeJYsXFOQiqQetFL()
	{
		VUjjFdeMXVjpMKMhYRosEXhUuLM = ReInput.editorPlatform != EditorPlatform.None;
		try
		{
			MGdUCgKavLcKdZVSFfqcdWqSuzTp();
		}
		catch
		{
			gQzGUxGfahvQPeTsdbAWUxXpdVCF();
			throw;
		}
	}

	public void gQzGUxGfahvQPeTsdbAWUxXpdVCF()
	{
		Dispose();
	}

	void uueYtIaFuqpDtLvuwArzLHVIeCr.gQzGUxGfahvQPeTsdbAWUxXpdVCF()
	{
		//ILSpy generated this explicit interface implementation from .override directive in gQzGUxGfahvQPeTsdbAWUxXpdVCF
		this.gQzGUxGfahvQPeTsdbAWUxXpdVCF();
	}

	private void MGdUCgKavLcKdZVSFfqcdWqSuzTp()
	{
		fLMJtkatgGadyaoVwasKEDivlwip();
		cGXsBvuVVhZxTbvVTlcbffdVHPu();
		if (VUjjFdeMXVjpMKMhYRosEXhUuLM)
		{
			QCoNPBijDfLcXXQcHwZHDPDFkqz = new wVnRJnyiuYlKPyyEIIoPAybhJhE();
			QCoNPBijDfLcXXQcHwZHDPDFkqz.kkiYOBQaAWTBmwGqCopYrgEejsVa(DLfbTaoDCcfsiFzruQuGdRsccpC, true);
		}
	}

	public void Dispose()
	{
		PMzamCeIIFqnzgwGlxEbIeTHBFUL(true);
		GC.SuppressFinalize(this);
	}

	~eHhFvRASFyFXeJYsXFOQiqQetFL()
	{
		PMzamCeIIFqnzgwGlxEbIeTHBFUL(false);
	}

	private void PMzamCeIIFqnzgwGlxEbIeTHBFUL(bool P_0)
	{
		if (jpnIPbpqmlecdiNqaFAxiNCsiMxs)
		{
			return;
		}
		if (VUjjFdeMXVjpMKMhYRosEXhUuLM)
		{
			QmjvwBHpzwQNlhCOTdTSEIFimJt();
			if (QCoNPBijDfLcXXQcHwZHDPDFkqz != null)
			{
				QCoNPBijDfLcXXQcHwZHDPDFkqz.Dispose();
			}
			if (CByBxCUKhKOJsFWCavGXqfwCGkN != null)
			{
				CByBxCUKhKOJsFWCavGXqfwCGkN.Dispose();
				CByBxCUKhKOJsFWCavGXqfwCGkN = null;
			}
		}
		else
		{
			QmjvwBHpzwQNlhCOTdTSEIFimJt();
			if (FYsFYuFxEQPhvrIGlRzuHTRvwXR != null)
			{
				FYsFYuFxEQPhvrIGlRzuHTRvwXR.Dispose();
			}
		}
		jpnIPbpqmlecdiNqaFAxiNCsiMxs = true;
	}

	private void cGXsBvuVVhZxTbvVTlcbffdVHPu()
	{
		cQIgVJJdisvDtRwntSvRLVibUPn.cGXsBvuVVhZxTbvVTlcbffdVHPu(MhbfrdOtrnfeYyGidkJneDJMCHl);
	}

	private void QmjvwBHpzwQNlhCOTdTSEIFimJt()
	{
		cQIgVJJdisvDtRwntSvRLVibUPn.QmjvwBHpzwQNlhCOTdTSEIFimJt();
	}

	private void rOzeIGgJMgOrRFYJLoGlELbLKnXF(hHVvumcFWVnIPBjOpTYVHDXWFQL P_0, EewfJPiHasEmIcMTTMpQEfUhPRej P_1, uint P_2, IntPtr P_3)
	{
		switch (P_2)
		{
		case 537u:
		{
			int num = P_1.GKKhtLNbvDBTmFgUzEAoIxHlPjY();
			if (P_3 == MhbfrdOtrnfeYyGidkJneDJMCHl)
			{
				switch (num)
				{
				case 32768:
					qssbxDKOsHmTthmzrBfaEqCIPoe?.Invoke(null);
					break;
				case 32772:
					WnixkiRzHZDcGoLvtzgfeoDtNns?.Invoke(null);
					break;
				case 32771:
					MhXobjWyTEqREAZtqhwtbUDnBlb?.Invoke(null);
					break;
				}
			}
			break;
		}
		case 7u:
		case 8u:
			if (riIEwybyjVOZyYtKuIovKpwwcmKD != null)
			{
				riIEwybyjVOZyYtKuIovKpwwcmKD(P_1, cmwBGCtbOdnPmdndepyeYPuXGzv.LnmQnIHPVviBNrHQAbuLIywwvko(P_2));
			}
			break;
		}
	}

	private void DLfbTaoDCcfsiFzruQuGdRsccpC(hHVvumcFWVnIPBjOpTYVHDXWFQL P_0, EewfJPiHasEmIcMTTMpQEfUhPRej P_1, uint P_2, IntPtr P_3)
	{
		if (P_2 == 8 && riIEwybyjVOZyYtKuIovKpwwcmKD != null)
		{
			riIEwybyjVOZyYtKuIovKpwwcmKD(P_1, cmwBGCtbOdnPmdndepyeYPuXGzv.LnmQnIHPVviBNrHQAbuLIywwvko(P_2));
		}
	}

	private void fLMJtkatgGadyaoVwasKEDivlwip()
	{
		if (CByBxCUKhKOJsFWCavGXqfwCGkN == null)
		{
			CByBxCUKhKOJsFWCavGXqfwCGkN = new iDxdeTNcZIetTcswDuZFhoDBYPo("RewiredWDMWindow", createMessageOnlyWindow: true, RWJcfTVejLkiLHTWybWqxNVoFTm);
			if (CByBxCUKhKOJsFWCavGXqfwCGkN.APllICJNRJmhlyPnfYfDTmikppa == IntPtr.Zero)
			{
				throw new Exception("Error creating window.");
			}
		}
		else
		{
			if (CByBxCUKhKOJsFWCavGXqfwCGkN.APllICJNRJmhlyPnfYfDTmikppa == IntPtr.Zero)
			{
				throw new Exception("Message window has invalid handle.");
			}
			CByBxCUKhKOJsFWCavGXqfwCGkN.JefgVwyclCCYjHhdlmUcjDeZlSDO(RWJcfTVejLkiLHTWybWqxNVoFTm);
		}
		MhbfrdOtrnfeYyGidkJneDJMCHl = CByBxCUKhKOJsFWCavGXqfwCGkN.APllICJNRJmhlyPnfYfDTmikppa;
	}

	private IntPtr RWJcfTVejLkiLHTWybWqxNVoFTm(IntPtr P_0, uint P_1, IntPtr P_2, IntPtr P_3)
	{
		rOzeIGgJMgOrRFYJLoGlELbLKnXF(P_3, P_2, P_1, P_0);
		return IntPtr.Zero;
	}
}
