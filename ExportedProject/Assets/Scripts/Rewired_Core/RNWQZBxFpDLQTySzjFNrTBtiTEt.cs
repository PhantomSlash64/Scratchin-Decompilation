using System;
using System.Collections.Generic;
using Rewired;
using Rewired.Config;
using Rewired.Utils;
using Rewired.Utils.Classes.Data;
using UnityEngine;

internal class RNWQZBxFpDLQTySzjFNrTBtiTEt
{
	public class SBBoyCeUBmWptGMEWBkBEGYAwiv
	{
		private class JiaSQfddZbYMUvDELtEzyJGpzHW : ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>.dCHFaZShTBabDEGADjARTEvjaeF, IComparable<JiaSQfddZbYMUvDELtEzyJGpzHW>
		{
			public KeyboardKeyCode fOeEjmDvcmIurnFXpoRksQpExxr;

			public ModifierKeyFlags wcAzJqRCmyKizSkbnLeXUXGZqme;

			public void BlEpJzKrARSmsemSZuRuhnNljiDf(KeyboardKeyCode P_0, ModifierKeyFlags P_1)
			{
				fOeEjmDvcmIurnFXpoRksQpExxr = P_0;
				wcAzJqRCmyKizSkbnLeXUXGZqme = P_1;
			}

			public void BlEpJzKrARSmsemSZuRuhnNljiDf(JiaSQfddZbYMUvDELtEzyJGpzHW P_0)
			{
				fOeEjmDvcmIurnFXpoRksQpExxr = P_0.fOeEjmDvcmIurnFXpoRksQpExxr;
				wcAzJqRCmyKizSkbnLeXUXGZqme = P_0.wcAzJqRCmyKizSkbnLeXUXGZqme;
			}

			void ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>.dCHFaZShTBabDEGADjARTEvjaeF.BlEpJzKrARSmsemSZuRuhnNljiDf(JiaSQfddZbYMUvDELtEzyJGpzHW P_0)
			{
				//ILSpy generated this explicit interface implementation from .override directive in BlEpJzKrARSmsemSZuRuhnNljiDf
				this.BlEpJzKrARSmsemSZuRuhnNljiDf(P_0);
			}

			public bool DgmbuafWJZMEqPkddeXpJOTtrvLd(JiaSQfddZbYMUvDELtEzyJGpzHW P_0)
			{
				if (fOeEjmDvcmIurnFXpoRksQpExxr == P_0.fOeEjmDvcmIurnFXpoRksQpExxr && wcAzJqRCmyKizSkbnLeXUXGZqme == P_0.wcAzJqRCmyKizSkbnLeXUXGZqme)
				{
					return true;
				}
				return false;
			}

			bool ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>.dCHFaZShTBabDEGADjARTEvjaeF.DgmbuafWJZMEqPkddeXpJOTtrvLd(JiaSQfddZbYMUvDELtEzyJGpzHW P_0)
			{
				//ILSpy generated this explicit interface implementation from .override directive in DgmbuafWJZMEqPkddeXpJOTtrvLd
				return this.DgmbuafWJZMEqPkddeXpJOTtrvLd(P_0);
			}

			public void LlCkzvOeJVaCziTDPktzBWuYotAZ()
			{
				fOeEjmDvcmIurnFXpoRksQpExxr = KeyboardKeyCode.None;
				wcAzJqRCmyKizSkbnLeXUXGZqme = ModifierKeyFlags.None;
			}

			void ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>.dCHFaZShTBabDEGADjARTEvjaeF.LlCkzvOeJVaCziTDPktzBWuYotAZ()
			{
				//ILSpy generated this explicit interface implementation from .override directive in LlCkzvOeJVaCziTDPktzBWuYotAZ
				this.LlCkzvOeJVaCziTDPktzBWuYotAZ();
			}

			public int CompareTo(JiaSQfddZbYMUvDELtEzyJGpzHW other)
			{
				return 0;
			}
		}

		private enum FTRTDYODJqmgaPjUmxsVuIipdPI
		{
			liExBHDUMZSZohTPXkqdvVafiyq = 0,
			ZTOMZfVaBxagPiwpjUzIHITDBLf = 1
		}

		private ModifierKeyFlags VxGOCNzuClNkEuoQihugSEsEVtb;

		private ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW> CNyfxbEpWPthIKwURnigrATLZSxS;

		private ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW> BRjapVlIBVDuXlvGmrdiDsmkOKC;

		private Keyboard NwgwDBihqBfhaFpOSpkapYWfrwcQ;

		public SBBoyCeUBmWptGMEWBkBEGYAwiv(Keyboard keyboard)
		{
			NwgwDBihqBfhaFpOSpkapYWfrwcQ = keyboard;
			VxGOCNzuClNkEuoQihugSEsEVtb = ModifierKeyFlags.None;
			CNyfxbEpWPthIKwURnigrATLZSxS = new ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>(132, clearData: false, 132);
			BRjapVlIBVDuXlvGmrdiDsmkOKC = new ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW>(5, clearData: false, 5);
		}

		public void mtiNfGzpXHszOwiOIAVYQuMZclV()
		{
			VxGOCNzuClNkEuoQihugSEsEVtb = ModifierKeyFlags.None;
			CNyfxbEpWPthIKwURnigrATLZSxS.Clear();
			int length = BRjapVlIBVDuXlvGmrdiDsmkOKC.Length;
			for (int num = length - 1; num >= 0; num--)
			{
				JiaSQfddZbYMUvDELtEzyJGpzHW jiaSQfddZbYMUvDELtEzyJGpzHW = BRjapVlIBVDuXlvGmrdiDsmkOKC[num];
				if (!NwgwDBihqBfhaFpOSpkapYWfrwcQ.YUfaFlKYUgmdNJpByjKRaxYROqJ(jiaSQfddZbYMUvDELtEzyJGpzHW.fOeEjmDvcmIurnFXpoRksQpExxr))
				{
					BRjapVlIBVDuXlvGmrdiDsmkOKC.RemoveAt(num);
				}
			}
		}

		public void zLoOBlZHKOZiIxMDdVRsnlWQyHY(ActionElementMap P_0)
		{
			if (P_0 != null)
			{
				VxGOCNzuClNkEuoQihugSEsEVtb |= P_0.modifierKeyFlags;
				CNyfxbEpWPthIKwURnigrATLZSxS.injector.BlEpJzKrARSmsemSZuRuhnNljiDf(P_0._keyboardKeyCode, P_0.modifierKeyFlags);
				CNyfxbEpWPthIKwURnigrATLZSxS.Inject();
			}
		}

		public bool flrSyPrdXSUCxHEzcrynAQOqfDd(KeyboardKeyCode P_0, ModifierKeyFlags P_1)
		{
			if (VxGOCNzuClNkEuoQihugSEsEVtb == ModifierKeyFlags.None && P_1 == ModifierKeyFlags.None)
			{
				return false;
			}
			int num = Keyboard.AGXXFucjAlzWunSKvUAKvEqBQLk(P_1);
			if (flrSyPrdXSUCxHEzcrynAQOqfDd(CNyfxbEpWPthIKwURnigrATLZSxS, P_0, P_1, num, FTRTDYODJqmgaPjUmxsVuIipdPI.liExBHDUMZSZohTPXkqdvVafiyq))
			{
				return true;
			}
			if (flrSyPrdXSUCxHEzcrynAQOqfDd(BRjapVlIBVDuXlvGmrdiDsmkOKC, P_0, P_1, num, FTRTDYODJqmgaPjUmxsVuIipdPI.ZTOMZfVaBxagPiwpjUzIHITDBLf))
			{
				return true;
			}
			if (P_1 != 0)
			{
				BRjapVlIBVDuXlvGmrdiDsmkOKC.injector.BlEpJzKrARSmsemSZuRuhnNljiDf(P_0, P_1);
				BRjapVlIBVDuXlvGmrdiDsmkOKC.InjectIfUnique();
			}
			return false;
		}

		private bool flrSyPrdXSUCxHEzcrynAQOqfDd(ExpandableArray_DataContainer<JiaSQfddZbYMUvDELtEzyJGpzHW> P_0, KeyboardKeyCode P_1, ModifierKeyFlags P_2, int P_3, FTRTDYODJqmgaPjUmxsVuIipdPI P_4)
		{
			bool flag = Keyboard.ymBoYIxxWyFuJIVtUdDalGrgRNY(P_1);
			int length = P_0.Length;
			for (int i = 0; i < length; i++)
			{
				JiaSQfddZbYMUvDELtEzyJGpzHW jiaSQfddZbYMUvDELtEzyJGpzHW = P_0[i];
				bool flag2 = jiaSQfddZbYMUvDELtEzyJGpzHW.fOeEjmDvcmIurnFXpoRksQpExxr == P_1;
				if ((flag2 && jiaSQfddZbYMUvDELtEzyJGpzHW.wcAzJqRCmyKizSkbnLeXUXGZqme == P_2) || (!flag2 && !Keyboard.ModifierKeyFlagsContain(jiaSQfddZbYMUvDELtEzyJGpzHW.wcAzJqRCmyKizSkbnLeXUXGZqme, (KeyCode)P_1) && !MathTools.nIYqxPCEgduiAcFHOBYqDVpIzSGn((int)jiaSQfddZbYMUvDELtEzyJGpzHW.wcAzJqRCmyKizSkbnLeXUXGZqme, (int)P_2)) || (!flag && jiaSQfddZbYMUvDELtEzyJGpzHW.fOeEjmDvcmIurnFXpoRksQpExxr != P_1))
				{
					continue;
				}
				int num = Keyboard.AGXXFucjAlzWunSKvUAKvEqBQLk(jiaSQfddZbYMUvDELtEzyJGpzHW.wcAzJqRCmyKizSkbnLeXUXGZqme);
				if (num > P_3)
				{
					if (P_4 != 0)
					{
						return true;
					}
					if (NwgwDBihqBfhaFpOSpkapYWfrwcQ.wbATQgOLQewsaRBOOMImAFIaeMaI(jiaSQfddZbYMUvDELtEzyJGpzHW.fOeEjmDvcmIurnFXpoRksQpExxr, jiaSQfddZbYMUvDELtEzyJGpzHW.wcAzJqRCmyKizSkbnLeXUXGZqme))
					{
						return true;
					}
				}
			}
			return false;
		}

		public void LlCkzvOeJVaCziTDPktzBWuYotAZ()
		{
			VxGOCNzuClNkEuoQihugSEsEVtb = ModifierKeyFlags.None;
			CNyfxbEpWPthIKwURnigrATLZSxS.Clear();
			BRjapVlIBVDuXlvGmrdiDsmkOKC.Clear();
		}
	}

	private readonly SBBoyCeUBmWptGMEWBkBEGYAwiv[] GZiKkeidqaTfqSdbqalEscYeqpT;

	private UpdateLoopType TnidRhAIPvMICseBcUJBQDrSFxL;

	private readonly Keyboard NwgwDBihqBfhaFpOSpkapYWfrwcQ;

	private SBBoyCeUBmWptGMEWBkBEGYAwiv HBFpvdVSEToPvyDvjayPiQyuurNQ;

	public RNWQZBxFpDLQTySzjFNrTBtiTEt(UpdateLoopSetting updateLoopSetting, Keyboard keyboard)
	{
		NwgwDBihqBfhaFpOSpkapYWfrwcQ = keyboard;
		GZiKkeidqaTfqSdbqalEscYeqpT = new SBBoyCeUBmWptGMEWBkBEGYAwiv[3];
		int num = 0;
		using TempListPool.TList<UpdateLoopType> tList = TempListPool.GetTList<UpdateLoopType>(3);
		List<UpdateLoopType> list = tList.list;
		EnumConverter.ToUpdateLoopTypes(updateLoopSetting, list);
		for (int i = 0; i < list.Count; i++)
		{
			SBBoyCeUBmWptGMEWBkBEGYAwiv sBBoyCeUBmWptGMEWBkBEGYAwiv = new SBBoyCeUBmWptGMEWBkBEGYAwiv(keyboard);
			GZiKkeidqaTfqSdbqalEscYeqpT[(int)list[i]] = sBBoyCeUBmWptGMEWBkBEGYAwiv;
			num++;
			if (num == 1)
			{
				HBFpvdVSEToPvyDvjayPiQyuurNQ = sBBoyCeUBmWptGMEWBkBEGYAwiv;
			}
		}
	}

	public void mtiNfGzpXHszOwiOIAVYQuMZclV(UpdateLoopType P_0)
	{
		if (TnidRhAIPvMICseBcUJBQDrSFxL != P_0)
		{
			TnidRhAIPvMICseBcUJBQDrSFxL = P_0;
			HBFpvdVSEToPvyDvjayPiQyuurNQ = GZiKkeidqaTfqSdbqalEscYeqpT[(int)P_0];
		}
		HBFpvdVSEToPvyDvjayPiQyuurNQ.mtiNfGzpXHszOwiOIAVYQuMZclV();
	}

	public void KKePYWsJkMNDYKtRtNARncIAcLb(KeyboardMap P_0)
	{
		if (P_0 == null)
		{
			return;
		}
		AList<ActionElementMap> buttonMaps_orig = P_0.ButtonMaps_orig;
		int count = buttonMaps_orig._count;
		for (int i = 0; i < count; i++)
		{
			ActionElementMap actionElementMap = buttonMaps_orig._items[i];
			if (actionElementMap.hasModifiers)
			{
				HBFpvdVSEToPvyDvjayPiQyuurNQ.zLoOBlZHKOZiIxMDdVRsnlWQyHY(actionElementMap);
			}
		}
	}

	public bool flrSyPrdXSUCxHEzcrynAQOqfDd(KeyboardKeyCode P_0, ModifierKeyFlags P_1)
	{
		return HBFpvdVSEToPvyDvjayPiQyuurNQ.flrSyPrdXSUCxHEzcrynAQOqfDd(P_0, P_1);
	}

	public void OrtqCOFFOrtonVeKwJffJoiHExO()
	{
		for (int i = 0; i < GZiKkeidqaTfqSdbqalEscYeqpT.Length; i++)
		{
			if (GZiKkeidqaTfqSdbqalEscYeqpT[i] != null)
			{
				GZiKkeidqaTfqSdbqalEscYeqpT[i].LlCkzvOeJVaCziTDPktzBWuYotAZ();
			}
		}
	}
}
